# Use with your existing docker-compose.yml:
#   docker compose -f docker-compose.yml -f docker-compose.nginx-static.yml up --build
#
# This adds an nginx reverse-proxy that serves /static (Django admin CSS/JS) and /api/media
# and proxies everything else to the "backend" service.
#
# By default it binds to host port 6384 to avoid conflicts with your current backend mapping (often 6382).
# When you're ready to move admin/API behind nginx on 6382, change 6384 -> 6382 and remove the 6382 mapping from backend in docker-compose.yml.

services:
  backend:
    # Share static/media with nginx
    volumes:
      - staticfiles:/app/staticfiles
      - media:/app/media

  backend_nginx:
    image: nginx:1.27-alpine
    depends_on:
      - backend
    ports:
      - "6384:80"
    volumes:
      - ./nginx/backend.conf:/etc/nginx/conf.d/default.conf:ro
      - staticfiles:/static:ro
      - media:/media:ro

volumes:
  staticfiles:
  media:
